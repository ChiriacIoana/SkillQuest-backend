// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  //output   = "./node_modules/@prisma/client"
}

datasource db {
  provider = "postgres"
  url      = env("DATABASE_URL")
}

model User {
  userId          Int          @id @default(autoincrement())
  username        String       @unique
  password        String
  level           Int          @default(1)
  currentXP       Int          @default(0)
  nextLevelXP     Int          @default(500)
  completedQuests Int          @default(0)
  streak          Int          @default(0)
  achievements    UserAchievement[]
  userQuests      UserQuest[]
}

model Quest {
  questId     Int          @id @default(autoincrement())
  questName   String
  description String?
  xp          Int
  category    String       @default("Calculus")
  questionIds  Int[]       @default([]) 
  difficulty  String       @default("Intermediate")
  isActive    Boolean      @default(true)
  userQuests  UserQuest[]

}

model UserQuest {
  id          Int      @id @default(autoincrement())
  userId      Int
  questId     Int
  completed   Boolean  @default(false)
  completedAt DateTime?
  
  user  User  @relation(fields: [userId], references: [userId])
  quest Quest @relation(fields: [questId], references: [questId])

  @@unique([userId, questId], name: "userId_questId")
}

model QuizQuestion {
  id           Int      @id @default(autoincrement())
  externalId   String?  @unique 
  source       String   
  category     String
  difficulty   String?
  question     String   @db.Text
  answersJson  String  
  correctIndex Int?
  xp           Int      @default(50)
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
}

model Achievement {
  id          Int      @id @default(autoincrement())
  name        String
  description String
  icon        String   // emoji or icon name
  xpRequired  Int?     // for XP-based achievements
  questsRequired Int?  // for quest-based achievements
  category    String   // "xp", "quests", "streak", etc.
  rarity      String   @default("common") // common, rare, epic, legendary
  createdAt   DateTime @default(now())
  
  userAchievements UserAchievement[]
}

model UserAchievement {
  id            Int      @id @default(autoincrement())
  userId        Int
  achievementId Int
  unlockedAt    DateTime @default(now())
  
  user          User         @relation(fields: [userId], references: [userId], onDelete: Cascade)
  achievement   Achievement  @relation(fields: [achievementId], references: [id], onDelete: Cascade)
  
  @@unique([userId, achievementId])
  @@index([userId])
}

